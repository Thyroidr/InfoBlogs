<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 5.3.0">
  <link rel="apple-touch-icon" sizes="180x180" href="/InfoBlogs/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/InfoBlogs/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/InfoBlogs/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/InfoBlogs/images/logo.svg" color="#222">

<link rel="stylesheet" href="/InfoBlogs/css/main.css">


<link rel="stylesheet" href="/InfoBlogs/lib/font-awesome/css/all.min.css">

<script id="hexo-configurations">
    var NexT = window.NexT || {};
    var CONFIG = {"hostname":"thyroidr.github.io","root":"/InfoBlogs/","scheme":"Mist","version":"7.8.0","exturl":false,"sidebar":{"position":"left","Muse | Mist":280,"display":"always","padding":18,"offset":12,"onmobile":false},"copycode":{"enable":false,"show_result":false,"style":null},"back2top":{"enable":true,"sidebar":false,"scrollpercent":false},"bookmark":{"enable":false,"color":"#222","save":"auto"},"fancybox":false,"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"algolia":{"hits":{"per_page":10},"labels":{"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}},"localsearch":{"enable":false,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false},"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}}};
  </script>

  <meta name="description" content="Q1: SianoYou can find the original problem in both Polish and Chinese. English TranslationThe farmer Byteasar bought a field with an area of ​​$n$ acres, on which he intends to sow the grass. Mowed an">
<meta property="og:type" content="article">
<meta property="og:title" content="Virtual Contest 2018&#x2F;09&#x2F;18">
<meta property="og:url" content="https://thyroidr.github.io/InfoBlogs/DTOJ/DTOJ/virtual-contest-2018-09-18/">
<meta property="og:site_name" content="InfoBlogs">
<meta property="og:description" content="Q1: SianoYou can find the original problem in both Polish and Chinese. English TranslationThe farmer Byteasar bought a field with an area of ​​$n$ acres, on which he intends to sow the grass. Mowed an">
<meta property="og:locale" content="en_US">
<meta property="article:published_time" content="2018-09-18T13:03:36.000Z">
<meta property="article:modified_time" content="2019-04-17T01:38:56.000Z">
<meta property="article:author" content="Ryan Wang">
<meta property="article:tag" content="c++">
<meta property="article:tag" content="segtree">
<meta property="article:tag" content="monotone data structures">
<meta name="twitter:card" content="summary">

<link rel="canonical" href="https://thyroidr.github.io/InfoBlogs/DTOJ/DTOJ/virtual-contest-2018-09-18/">


<script id="page-configurations">
  // https://hexo.io/docs/variables.html
  CONFIG.page = {
    sidebar: "",
    isHome : false,
    isPost : true,
    lang   : 'en'
  };
</script>

  <title>Virtual Contest 2018/09/18 | InfoBlogs</title>
  






  <noscript>
  <style>
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-header { opacity: initial; }

  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>

</head>

<body itemscope itemtype="http://schema.org/WebPage">
  <div class="container use-motion">
    <div class="headband"></div>

    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="Toggle navigation bar">
      <span class="toggle-line toggle-line-first"></span>
      <span class="toggle-line toggle-line-middle"></span>
      <span class="toggle-line toggle-line-last"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/InfoBlogs/" class="brand" rel="start">
      <span class="logo-line-before"><i></i></span>
      <h1 class="site-title">InfoBlogs</h1>
      <span class="logo-line-after"><i></i></span>
    </a>
      <p class="site-subtitle" itemprop="description">by Ryan Wang</p>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
    </div>
  </div>
</div>




<nav class="site-nav">
  <ul id="menu" class="main-menu menu">
        <li class="menu-item menu-item-home">

    <a href="/InfoBlogs/" rel="section"><i class="fa fa-home fa-fw"></i>Home</a>

  </li>
        <li class="menu-item menu-item-tags">

    <a href="/InfoBlogs/tags/" rel="section"><i class="fa fa-tags fa-fw"></i>Tags</a>

  </li>
        <li class="menu-item menu-item-categories">

    <a href="/InfoBlogs/categories/" rel="section"><i class="fa fa-th fa-fw"></i>Categories</a>

  </li>
        <li class="menu-item menu-item-archives">

    <a href="/InfoBlogs/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>Archives</a>

  </li>
  </ul>
</nav>




</div>
    </header>

    
  <div class="back-to-top">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>

  <a href="https://github.com/thyroidr" class="github-corner" title="Follow me on GitHub" aria-label="Follow me on GitHub" rel="noopener" target="_blank"><svg width="80" height="80" viewBox="0 0 250 250" aria-hidden="true"><path d="M0,0 L115,115 L130,115 L142,142 L250,250 L250,0 Z"></path><path d="M128.3,109.0 C113.8,99.7 119.0,89.6 119.0,89.6 C122.0,82.7 120.5,78.6 120.5,78.6 C119.2,72.0 123.4,76.3 123.4,76.3 C127.3,80.9 125.5,87.3 125.5,87.3 C122.9,97.6 130.6,101.9 134.4,103.2" fill="currentColor" style="transform-origin: 130px 106px;" class="octo-arm"></path><path d="M115.0,115.0 C114.9,115.1 118.7,116.5 119.8,115.4 L133.7,101.6 C136.9,99.2 139.9,98.4 142.2,98.6 C133.8,88.0 127.5,74.4 143.8,58.0 C148.5,53.4 154.0,51.2 159.7,51.0 C160.3,49.4 163.2,43.6 171.4,40.1 C171.4,40.1 176.1,42.5 178.8,56.2 C183.1,58.6 187.2,61.8 190.9,65.4 C194.5,69.0 197.7,73.2 200.1,77.6 C213.8,80.2 216.3,84.9 216.3,84.9 C212.7,93.1 206.9,96.0 205.4,96.6 C205.1,102.4 203.0,107.8 198.3,112.5 C181.9,128.9 168.3,122.5 157.7,114.1 C157.9,116.9 156.7,120.9 152.7,124.9 L141.0,136.5 C139.8,137.7 141.6,141.9 141.8,141.8 Z" fill="currentColor" class="octo-body"></path></svg></a>


    <main class="main">
      <div class="main-inner">
        <div class="content-wrap">
          

          <div class="content post posts-expand">
            

    
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="en">
    <link itemprop="mainEntityOfPage" href="https://thyroidr.github.io/InfoBlogs/DTOJ/DTOJ/virtual-contest-2018-09-18/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/InfoBlogs/images/avatar.png">
      <meta itemprop="name" content="Ryan Wang">
      <meta itemprop="description" content="Museum of my involvement in Informatics Olympiads & competitive programming">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="InfoBlogs">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          Virtual Contest 2018/09/18
        </h1>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2018-09-18 23:03:36" itemprop="dateCreated datePublished" datetime="2018-09-18T23:03:36+10:00">2018-09-18</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2019-04-17 11:38:56" itemprop="dateModified" datetime="2019-04-17T11:38:56+10:00">2019-04-17</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">In</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/InfoBlogs/categories/DTOJ/" itemprop="url" rel="index"><span itemprop="name">DTOJ</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
        <h2 id="Q1-Siano"><a href="#Q1-Siano" class="headerlink" title="Q1: Siano"></a>Q1: Siano</h2><p>You can find the original problem in both <a target="_blank" rel="noopener" href="https://sio2.mimuw.edu.pl/c/pa-2015-1/p/sia/">Polish</a> and <a target="_blank" rel="noopener" href="https://zqlwmatt.github.io/JudgeOnline/4293.html">Chinese</a>.</p>
<h3 id="English-Translation"><a href="#English-Translation" class="headerlink" title="English Translation"></a>English Translation</h3><p>The farmer Byteasar bought a field with an area of ​​$n$ acres, on which he intends to sow the grass. Mowed and dried grass will be used as feed for animals bred on the Byteasar farm. A mixture of $n$ grass species will be sown in the field - each species will occupy a total of $1$ acre of land.</p>
<p>It is known about the $i$-th species that for one day a blade of grass of this species grows by $a_i$ centimeters, independent of weather conditions and soil fertility. It is also known that from cutting one centimeter of grass on in the area of ​​one macaw, exactly $1$ kilogram of hay is obtained. Byteasar has a mower that can be adjusted to cut the grass to any height $b$ centimeters. In this setting, every blade of grass higher than $b$ centimeters will be cut to exactly the height $b$ centimeters.</p>
<a id="more"></a>
<p>Bytie kingdom law requires the weight of grass obtained to be documented each time grass is mown. Byteasar is faced with a choice: he could either buy a weight or write a program based on dates mowing and mower settings, which would output the weight of hay obtained after each mowing. The second of these options has been selected since it&#39;s more convenient and cheaper. We assume that the grass will be sown on day 0 at midnight and will always be mowed at midnight. We assume also that the time needed to mow the field to any height $b$ is negligibly small.</p>
<h3 id="Input"><a href="#Input" class="headerlink" title="Input"></a>Input</h3><p>In the first line of the input there are two integers $n$ and $m$ ($1 \le n$, $m \le 500,000$), denoting respectively the area of ​​Bytesar&#39;s field in ares (and at the same time the number of sown grass species) and the number of mowings. The second line contains a sequence of $n$ integers $a_1,a_2,\cdots,a_n (1 \le a_i \le 10^6)$ indicating growth rate of subsequent grass species.</p>
<p>In the following $m$ lines there are descriptions of the mowings made by Byteasar: $d_i$ and $b_i$, signifying that $d_i$ days after planting he cut the grass to the height of $b_i$ ($1 \le d_i \le 10^{12}$, $1 \le b_i \le 10^{12}$). The descriptions are given in chronological order and you may assume no grass will ever have a height exceeding $10^{12}$ centimeters.</p>
<h3 id="Output"><a href="#Output" class="headerlink" title="Output"></a>Output</h3><p>$m$ lines, the $i$-th describes the weight of grass obtained after the $i$-th mowing.</p>
<h3 id="Sample-IO"><a href="#Sample-IO" class="headerlink" title="Sample IO"></a>Sample IO</h3><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">Input:</span><br><span class="line"><span class="number">4</span> <span class="number">4</span></span><br><span class="line"><span class="number">1</span> <span class="number">2</span> <span class="number">4</span> <span class="number">3</span></span><br><span class="line"><span class="number">1</span> <span class="number">1</span></span><br><span class="line"><span class="number">2</span> <span class="number">2</span></span><br><span class="line"><span class="number">3</span> <span class="number">0</span></span><br><span class="line"><span class="number">4</span> <span class="number">4</span></span><br><span class="line"></span><br><span class="line">Output:</span><br><span class="line"><span class="number">6</span></span><br><span class="line"><span class="number">6</span></span><br><span class="line"><span class="number">18</span></span><br><span class="line"><span class="number">0</span></span><br></pre></td></tr></table></figure>
<h3 id="Solution"><a href="#Solution" class="headerlink" title="Solution"></a>Solution</h3><p>We can first sort the grass by their growing rate, such that we can use binary search to find the range of grass that would be mown. Notice that this range is a suffix. We can then use a segment tree to maintain the $n$ grass. For each mowing, we find the suffix to be mown and update it accordingly. When updating we can also maintain how much hay is obtained. Overall time complexity $O(m \log n)$.</p>
<p>将所有的草按$a_i$排序，这样每次割的时候我们就可用二分找左边界了。用线段树维护，在更新的时候可以顺便算出答案。cut存总被割掉的长度，MaxLen存区间最右草的高度（必然是区间最高），v存区间总生长速度，t存最后一次割的时间，除了v意外都要维护。postcut和lastcut是延时标记，存割后高度与最后一次割的时间。</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;bits/stdc++.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> fo(counter, starter, ender) for(ll counter = starter; counter &lt;= ender; counter++)</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> rfo(counter, starter, ender) for(ll counter = starter; counter &gt;= ender; counter--)</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> ll long long</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> INF 0x7fffffff</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> N 2001000</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> MOD 1000000007</span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</span><br><span class="line"><span class="function">ll <span class="title">qpow</span><span class="params">(ll x, ll y)</span></span>&#123;<span class="keyword">return</span> y?(y&amp;<span class="number">1</span>?x*qpow(x,y<span class="number">-1</span>)%MOD:qpow(x*x%MOD,y/<span class="number">2</span>)):<span class="number">1</span>;&#125;</span><br><span class="line"><span class="keyword">template</span>&lt;<span class="keyword">typename</span> T&gt;<span class="function"><span class="keyword">inline</span> <span class="keyword">void</span> <span class="title">read</span><span class="params">(T&amp;x)</span></span>&#123;</span><br><span class="line">    x = <span class="number">0</span>; <span class="keyword">char</span> c; <span class="keyword">int</span> sign = <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">do</span> &#123; c = getchar(); <span class="keyword">if</span>(c == <span class="string">&#x27;-&#x27;</span>) sign = <span class="number">-1</span>; &#125;<span class="keyword">while</span>(!<span class="built_in">isdigit</span>(c));</span><br><span class="line">    <span class="keyword">do</span> &#123; x = x * <span class="number">10</span> + c - <span class="string">&#x27;0&#x27;</span>; c = getchar(); &#125;<span class="keyword">while</span>(<span class="built_in">isdigit</span>(c));</span><br><span class="line">    x *= sign;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">ll a[N], Ans, T, L;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">segmentTree</span>&#123;</span></span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="class"><span class="keyword">struct</span> <span class="title">node</span>&#123;</span></span><br><span class="line">        ll v, t, cut, MaxLen;</span><br><span class="line">    &#125;t[N];</span><br><span class="line">    ll lastcut[N], postcut[N];</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">build</span><span class="params">(<span class="keyword">int</span> l, <span class="keyword">int</span> r, <span class="keyword">int</span> node)</span></span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(l == r) &#123;t[node].v = a[r]; <span class="keyword">return</span>;&#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">int</span> mid = (l+r) &gt;&gt; <span class="number">1</span>;</span><br><span class="line">        postcut[node] = lastcut[node] = <span class="number">-1</span>;</span><br><span class="line">        build(l, mid, node&lt;&lt;<span class="number">1</span>);</span><br><span class="line">        build(mid+<span class="number">1</span>, r, (node&lt;&lt;<span class="number">1</span>)+<span class="number">1</span>);</span><br><span class="line">        t[node].v = t[node&lt;&lt;<span class="number">1</span>].v + t[(node&lt;&lt;<span class="number">1</span>) + <span class="number">1</span>].v;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">pushdown</span><span class="params">(<span class="keyword">int</span> l, <span class="keyword">int</span> r, <span class="keyword">int</span> node)</span></span>&#123;</span><br><span class="line">        <span class="keyword">int</span> mid = (l+r)&gt;&gt;<span class="number">1</span>;</span><br><span class="line">        t[node&lt;&lt;<span class="number">1</span>].t = t[(node&lt;&lt;<span class="number">1</span>)+<span class="number">1</span>].t = lastcut[node];</span><br><span class="line">        t[node&lt;&lt;<span class="number">1</span>].MaxLen = t[(node&lt;&lt;<span class="number">1</span>)+<span class="number">1</span>].MaxLen = postcut[node];</span><br><span class="line">        t[node&lt;&lt;<span class="number">1</span>].cut = lastcut[node] * t[node&lt;&lt;<span class="number">1</span>].v - postcut[node] * (mid - l + <span class="number">1</span>);</span><br><span class="line">        t[(node&lt;&lt;<span class="number">1</span>)+<span class="number">1</span>].cut = lastcut[node] * t[(node&lt;&lt;<span class="number">1</span>)+<span class="number">1</span>].v - postcut[node] * (r - mid);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span>(l != r)&#123;</span><br><span class="line">            postcut[node&lt;&lt;<span class="number">1</span>] = postcut[(node&lt;&lt;<span class="number">1</span>)+<span class="number">1</span>] = postcut[node];</span><br><span class="line">            lastcut[node&lt;&lt;<span class="number">1</span>] = lastcut[(node&lt;&lt;<span class="number">1</span>)+<span class="number">1</span>] = lastcut[node];</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        postcut[node] = lastcut[node] = <span class="number">-1</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">collect</span><span class="params">(<span class="keyword">int</span> l, <span class="keyword">int</span> r, <span class="keyword">int</span> node)</span></span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(lastcut[node] &gt; <span class="number">0</span>)&#123;</span><br><span class="line">            t[node].cut = lastcut[node] * t[node].v - postcut[node] * (r-l+<span class="number">1</span>);</span><br><span class="line">            t[node].MaxLen = postcut[node];</span><br><span class="line">            t[node].t = lastcut[node];</span><br><span class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span> (l != r) &#123;</span><br><span class="line">            t[node].cut = t[node&lt;&lt;<span class="number">1</span>].cut + t[(node&lt;&lt;<span class="number">1</span>)+<span class="number">1</span>].cut;</span><br><span class="line">            t[node].MaxLen = t[(node&lt;&lt;<span class="number">1</span>)+<span class="number">1</span>].MaxLen;</span><br><span class="line">            t[node].t = t[(node&lt;&lt;<span class="number">1</span>)+<span class="number">1</span>].t;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">update</span><span class="params">(<span class="keyword">int</span> l, <span class="keyword">int</span> r, <span class="keyword">int</span> node, <span class="keyword">int</span> ql, <span class="keyword">int</span> qr)</span></span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(ql &lt;= l &amp;&amp; r &lt;= qr)&#123;</span><br><span class="line">            Ans += T * t[node].v - L * (r - l + <span class="number">1</span>) - t[node].cut;</span><br><span class="line">            lastcut[node] = T;</span><br><span class="line">            postcut[node] = L;</span><br><span class="line">            collect(l, r, node);</span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span>(lastcut[node] &gt;= <span class="number">0</span>) pushdown(l, r, node);</span><br><span class="line">        <span class="keyword">int</span> mid = (l+r)&gt;&gt;<span class="number">1</span>;</span><br><span class="line">        <span class="keyword">if</span>(ql &lt;= mid) update(l, mid, node&lt;&lt;<span class="number">1</span>, ql, qr);</span><br><span class="line">        <span class="keyword">if</span>(qr &gt;= mid + <span class="number">1</span>) update(mid+<span class="number">1</span>, r, (node&lt;&lt;<span class="number">1</span>)+<span class="number">1</span>, ql, qr);</span><br><span class="line">        collect(l, r, node);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">int</span> <span class="title">binary</span><span class="params">(<span class="keyword">int</span> l, <span class="keyword">int</span> r, <span class="keyword">int</span> node)</span></span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(l == r) <span class="keyword">return</span> r;</span><br><span class="line">        <span class="keyword">int</span> mid = (l+r)&gt;&gt;<span class="number">1</span>;</span><br><span class="line">        <span class="keyword">if</span>(lastcut[node] &gt;= <span class="number">0</span>) pushdown(l, r, node);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span>(t[node&lt;&lt;<span class="number">1</span>].MaxLen + (T - t[node&lt;&lt;<span class="number">1</span>].t) * a[mid] &gt; L)</span><br><span class="line">            <span class="keyword">return</span> binary(l, mid, node&lt;&lt;<span class="number">1</span>);</span><br><span class="line">        <span class="keyword">else</span></span><br><span class="line">            <span class="keyword">return</span> binary(mid+<span class="number">1</span>, r,( node&lt;&lt;<span class="number">1</span>)+<span class="number">1</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;tree;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line">    ll n, m, leftbound;</span><br><span class="line"></span><br><span class="line">    read(n), read(m);</span><br><span class="line">    fo(i, <span class="number">1</span>, n) read(a[i]);</span><br><span class="line">    sort(a+<span class="number">1</span>, a+n+<span class="number">1</span>);</span><br><span class="line">    tree.build(<span class="number">1</span>, n, <span class="number">1</span>);</span><br><span class="line">    <span class="keyword">while</span>(m--)&#123;</span><br><span class="line">        read(T), read(L);</span><br><span class="line">        <span class="keyword">if</span>(tree.t[<span class="number">1</span>].MaxLen + (T - tree.t[<span class="number">1</span>].t) * a[n] &lt;= L) <span class="built_in">puts</span>(<span class="string">&quot;0&quot;</span>);</span><br><span class="line">        <span class="keyword">else</span> &#123;</span><br><span class="line">            Ans = <span class="number">0</span>;</span><br><span class="line">            leftbound = tree.binary(<span class="number">1</span>, n, <span class="number">1</span>);</span><br><span class="line">            tree.update(<span class="number">1</span>, n, <span class="number">1</span>, leftbound, n);</span><br><span class="line">            <span class="built_in">printf</span>(<span class="string">&quot;%lld\n&quot;</span>, Ans);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="Q2-Rozstaw-Szyn"><a href="#Q2-Rozstaw-Szyn" class="headerlink" title="Q2: Rozstaw Szyn"></a>Q2: Rozstaw Szyn</h2><p><a target="_blank" rel="noopener" href="https://zqlwmatt.github.io/JudgeOnline/4297.html">Link (Chinese)</a><br>From PA2015.</p>
<h3 id="English-Translation-1"><a href="#English-Translation-1" class="headerlink" title="English Translation"></a>English Translation</h3><p>There is a tree with $n$ nodes, including $m$ leaf nodes. The $i$-th leaf node is labelled $i$, and has a weight of $r_i$. Your task is to assign the remaining $n-m$ nodes each a weight such that the sum of differences between all pairs of adjacent nodes is minimal.</p>
<h3 id="Input-1"><a href="#Input-1" class="headerlink" title="Input"></a>Input</h3><p>The first line contains two positive integers, $n$ and $m$, representing respectively the number of nodes and the number of leaf nodes.<br>The next $n-1$ lines each contain two positive integers, the labels of two connected nodes.<br>The next $m$ lines each contain a positive integer, the integer in the $i$-th line represents the weight of node $i$.</p>
<h3 id="Output-1"><a href="#Output-1" class="headerlink" title="Output"></a>Output</h3><p>An integer, the minimum sum of differences.</p>
<h3 id="Sample-IO-1"><a href="#Sample-IO-1" class="headerlink" title="Sample IO"></a>Sample IO</h3><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">Input:</span><br><span class="line"><span class="number">6</span> <span class="number">4</span></span><br><span class="line"><span class="number">1</span> <span class="number">5</span></span><br><span class="line"><span class="number">2</span> <span class="number">5</span></span><br><span class="line"><span class="number">3</span> <span class="number">6</span></span><br><span class="line"><span class="number">4</span> <span class="number">6</span></span><br><span class="line"><span class="number">5</span> <span class="number">6</span></span><br><span class="line"><span class="number">5</span></span><br><span class="line"><span class="number">10</span></span><br><span class="line"><span class="number">20</span></span><br><span class="line"><span class="number">40</span></span><br><span class="line"></span><br><span class="line">Output:</span><br><span class="line"><span class="number">35</span></span><br></pre></td></tr></table></figure>
<h3 id="Solution-1"><a href="#Solution-1" class="headerlink" title="Solution"></a>Solution</h3><p>这题我是看<a target="_blank" rel="noopener" href="https://cydiater.me/2018/06/24/%E3%80%8CPA2015%E3%80%8DRozstaw-szyn/">题解</a>的。<br>We shall first consider a special case, where $n-m=1$, in which case the root should obviously be assigned the median of all leaf nodes. Note that if there is an even number of leaf nodes then any value inclusively between the two medians is legal.</p>
<p>We now consider expanding this special case. Define the legal range, $l$ to $r$, of a node such that when the value of the node is within this range its contribution to the final answer is minimal. For any node, if we know the legal range of all its sons, we can conclude that the legal range of this node is the median(s) of $l$s and $r$s of the son legal ranges. To prove this quickly, notice that the legal range for the father node must be two adjacent endpoints such that there are equal numbers of complete ranges to the right and left. Also notice the contribution of the father node qualifies for ternary search (when graphed it looks like a valley). Hence if we move this range to the right of left, the contribution increases.</p>
<p>Now we shall consider why it is right to deduct the father&#39;s legal range based on the sons&#39; legal range. If we move the sons&#39; range to any direction, it might lower the father&#39;s contribution, but it increases the son&#39;s contribution by an amount no lesser. Hence, moving the sons&#39; ranges is never optimal.</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;bits/stdc++.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> fo(counter, starter, ender) for(ll counter = starter; counter &lt;= ender; counter++)</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> rfo(counter, starter, ender) for(ll counter = starter; counter &gt;= ender; counter--)</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> ll long long</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> INF 0x7fffffff</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> N 500010</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> MOD 1000000007</span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</span><br><span class="line"><span class="function">ll <span class="title">qpow</span><span class="params">(ll x, ll y)</span></span>&#123;<span class="keyword">return</span> y?(y&amp;<span class="number">1</span>?x*qpow(x,y<span class="number">-1</span>)%MOD:qpow(x*x%MOD,y/<span class="number">2</span>)):<span class="number">1</span>;&#125;</span><br><span class="line"><span class="keyword">template</span>&lt;<span class="keyword">typename</span> T&gt;<span class="function"><span class="keyword">inline</span> <span class="keyword">void</span> <span class="title">read</span><span class="params">(T&amp;x)</span></span>&#123;</span><br><span class="line">    x = <span class="number">0</span>; <span class="keyword">char</span> c; <span class="keyword">int</span> sign = <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">do</span> &#123; c = getchar(); <span class="keyword">if</span>(c == <span class="string">&#x27;-&#x27;</span>) sign = <span class="number">-1</span>; &#125;<span class="keyword">while</span>(!<span class="built_in">isdigit</span>(c));</span><br><span class="line">    <span class="keyword">do</span> &#123; x = x * <span class="number">10</span> + c - <span class="string">&#x27;0&#x27;</span>; c = getchar(); &#125;<span class="keyword">while</span>(<span class="built_in">isdigit</span>(c));</span><br><span class="line">    x *= sign;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">edge</span>&#123;</span></span><br><span class="line">    <span class="keyword">int</span> to, nx;</span><br><span class="line">    edge()&#123;&#125;</span><br><span class="line">    edge(<span class="keyword">int</span> _to, <span class="keyword">int</span> _nx):to(_to),nx(_nx)&#123;&#125;</span><br><span class="line">&#125;e[<span class="number">2</span>*N];</span><br><span class="line"></span><br><span class="line"><span class="keyword">int</span> front[N], ecnt, n, m, ccnt[N], lb[N], rb[N], pre[N], suf[N], a[N];</span><br><span class="line">ll ans;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">addEdge</span><span class="params">(<span class="keyword">int</span> u, <span class="keyword">int</span> v)</span></span>&#123;</span><br><span class="line">    e[++ecnt] = edge(v, front[u]); front[u] = ecnt;</span><br><span class="line">    e[++ecnt] = edge(u, front[v]); front[v] = ecnt;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">dfs</span><span class="params">(<span class="keyword">int</span> node, <span class="keyword">int</span> fa)</span></span>&#123;</span><br><span class="line">    <span class="keyword">if</span>(ccnt[node] == <span class="number">1</span>) <span class="keyword">return</span>;</span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> i = front[node]; i; i = e[i].nx)</span><br><span class="line">        <span class="keyword">if</span>(e[i].to != fa) dfs(e[i].to, node);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">int</span> atop = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> i = front[node]; i; i = e[i].nx)</span><br><span class="line">        <span class="keyword">if</span>(e[i].to != fa) a[++atop] = lb[e[i].to], a[++atop] = rb[e[i].to];</span><br><span class="line">    sort(a+<span class="number">1</span>, a+atop+<span class="number">1</span>);</span><br><span class="line">    atop = unique(a+<span class="number">1</span>, a+atop+<span class="number">1</span>) - a - <span class="number">1</span>;</span><br><span class="line">    fo(i, <span class="number">0</span>, atop+<span class="number">1</span>) pre[i] = suf[i] = <span class="number">0</span>;</span><br><span class="line">    ll Max = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> i = front[node]; i; i = e[i].nx)&#123;</span><br><span class="line">        <span class="keyword">if</span>(e[i].to == fa) <span class="keyword">continue</span>;</span><br><span class="line">        <span class="keyword">int</span> l = lower_bound(a+<span class="number">1</span>, a+atop+<span class="number">1</span>, lb[e[i].to]) - a;</span><br><span class="line">        <span class="keyword">int</span> r = lower_bound(a+<span class="number">1</span>, a+atop+<span class="number">1</span>, rb[e[i].to]) - a;</span><br><span class="line">        pre[r]++, suf[l]++;</span><br><span class="line">        Max += a[l] - a[<span class="number">1</span>];</span><br><span class="line">    &#125;</span><br><span class="line">    ll Min = Max; lb[node] = rb[node] = a[<span class="number">1</span>];</span><br><span class="line">    fo(i, <span class="number">1</span>, atop) pre[i] += pre[i<span class="number">-1</span>];</span><br><span class="line">    rfo(i, atop, <span class="number">1</span>) suf[i] += suf[i+<span class="number">1</span>];</span><br><span class="line">    fo(i, <span class="number">2</span>, atop)&#123;</span><br><span class="line">        Max += (ll)(a[i] - a[i<span class="number">-1</span>]) * (pre[i<span class="number">-1</span>] - suf[i]);</span><br><span class="line">        <span class="keyword">if</span>(Max &lt; Min) Min = Max, rb[node] = lb[node] = a[i];</span><br><span class="line">        <span class="keyword">else</span> <span class="keyword">if</span>(Max == Min) rb[node] = a[i];</span><br><span class="line">    &#125;</span><br><span class="line">    ans += Min;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line">    read(n), read(m);</span><br><span class="line">    fo(i, <span class="number">1</span>, n<span class="number">-1</span>)&#123;</span><br><span class="line">        <span class="keyword">int</span> x, y;</span><br><span class="line">        read(x), read(y);</span><br><span class="line">        addEdge(x, y);</span><br><span class="line">        ccnt[x]++, ccnt[y]++;</span><br><span class="line">    &#125;</span><br><span class="line">    fo(i, <span class="number">1</span>, m) read(lb[i]), rb[i] = lb[i];</span><br><span class="line">    <span class="keyword">if</span>(n==<span class="number">2</span>) &#123;<span class="built_in">printf</span>(<span class="string">&quot;%d\n&quot;</span>, <span class="built_in">abs</span>(lb[<span class="number">1</span>]-lb[<span class="number">2</span>])); <span class="keyword">return</span> <span class="number">0</span>;&#125;</span><br><span class="line">    dfs(n, <span class="number">0</span>);</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;%lld\n&quot;</span>, ans);</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="Q3-Hazard"><a href="#Q3-Hazard" class="headerlink" title="Q3: Hazard"></a>Q3: Hazard</h2><p><a target="_blank" rel="noopener" href="https://zqlwmatt.github.io/JudgeOnline/4295.html">Problem Link (Chinese)</a></p>
<h3 id="Description"><a href="#Description" class="headerlink" title="Description"></a>Description</h3><p>There are $n$ people playing a gambling machine, the $i$-th of which owns $a_i$ dollars in the beginning. The gambling machine can be represented as a sequence (size $m$) of $1$s and $-1$s, drawing $1$ means earning a buck and drawing $-1$ means losing a buck. In the first round, the first person draws the first element of the sequence; in the second round, the second person draws the second element of the sequence, etc (not rigged). Specially, after the $n$-th person draws, the first person draws again. After the $m$-th element of the sequence is drawn, the $1$ element is drawn. If in some round, one person loses all their money, the gambling game ends. Find when the game will end, if it does not end, output $-1$.</p>
<h3 id="Input-2"><a href="#Input-2" class="headerlink" title="Input"></a>Input</h3><p>The first line contains $n$, the number of gamlers.<br>The second line contains $n$ positive integers, the $i$-th of which represents $a_i$, the amount of money owned by the $i$-th player in the beginning.<br>The third line contains $m$, the length of the <del>rigged</del> sequence.<br>The last line contains a string of length $m$, containing the sequence, $W$ represents gaining a dollar and $P$ represents losing a dollar.<br>($1 \le n, a_i, m \le 10^6$)</p>
<h3 id="Output-2"><a href="#Output-2" class="headerlink" title="Output"></a>Output</h3><p>If the game never ends, output $-1$, else output in which round the game ends.</p>
<h3 id="Sample-IO-2"><a href="#Sample-IO-2" class="headerlink" title="Sample IO"></a>Sample IO</h3><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">Input:</span><br><span class="line"><span class="number">4</span></span><br><span class="line"><span class="number">2</span> <span class="number">3</span> <span class="number">2</span> <span class="number">1</span></span><br><span class="line"><span class="number">3</span></span><br><span class="line">WPP</span><br><span class="line"></span><br><span class="line">Output:</span><br><span class="line"><span class="number">12</span></span><br></pre></td></tr></table></figure>
<h3 id="Solution-2"><a href="#Solution-2" class="headerlink" title="Solution"></a>Solution</h3><p>Obviously, every $LCM(n, m)$ rounds the game returns to its starting position, despite the players possibly owning different amounts of money than they started off with. You might expect me to solve the problem from this direction, but no, thank you!</p>
<p>What we will instead notice is that players are &quot;stuck&quot; in rings of sequence elements. Examine the table below ($m_i$ represents the $i$-th element of the sequence), all players are &quot;stuck&quot; in the ring of $m_1, m_2, m_3$. Notice that the players in the same ring may start from different positions of the ring. In addition, be assured that players are not necessarily all in the same ring (find a few examples yourself).</p>
<table>
<thead>
<tr>
<th>$a_1$</th>
<th>$a_2$</th>
<th>$a_3$</th>
<th>$a_4$</th>
</tr>
</thead>
<tbody><tr>
<td>$m_1$</td>
<td>$m_2$</td>
<td>$m_3$</td>
<td>$m_1$</td>
</tr>
<tr>
<td>$m_2$</td>
<td>$m_3$</td>
<td>$m_1$</td>
<td>$m_2$</td>
</tr>
<tr>
<td>$m_3$</td>
<td>$m_1$</td>
<td>$m_2$</td>
<td>$m_3$</td>
</tr>
<tr>
<td>$m_1$</td>
<td>$m_2$</td>
<td>$m_3$</td>
<td>$m_1$</td>
</tr>
<tr>
<td>$m_2$</td>
<td>$m_3$</td>
<td>$m_1$</td>
<td>$m_2$</td>
</tr>
<tr>
<td>$m_3$</td>
<td>$m_1$</td>
<td>$m_2$</td>
<td>$m_3$</td>
</tr>
</tbody></table>
<p>What we are sure, is that players repeat their ring until the game ends. Let the sum of all elements in a ring of size $k$ be $s = \sum_{i=1}^k m_i$ for all $m_i$ in the ring. Then each time a player repeats a ring, their possesion changes by $s$. The problem now transforms to finding out each ring and all the players in a ring, with these information we can find out how long each player lasts.</p>
<p>Given that $m_i$ is in a ring, we know that for all $j=(i+kn)%m$, $m_j$ is also in this ring. We can hence find out all elements in a ring as well as the sum of elements in this ring. Given that player $a_i$ is stuck in this ring, we can also know that for all $j=(i+km)%n$ player $a_j$ is also stuck in this ring. If for any ring, $s$ is negative, then the game is destined to end. The problem now becomes when exactly does the game end, is any $s$ is negative. Let the elements in a ring be $R= \{ r_1, r_2, r_3, \cdots \}$ and let $p_i= \sum_{j=1}^i r_j$. We know that if the remaining money of any player is less than $max(p_1, p_2, p_3, \cdots)$, then the player goes bankrupt. In addition, the player goes bankrupt before or at $p_{max}=max(p_1, p_2, p_3, \cdots)$. For details read the comments in my code.</p>
<p>我们可以发现所有的人都在一个或多个循环当中。这个循环每走一圈循环内的人的钱变化的量为循环的和。对于任意输入，假若有一个循环和为负，游戏必然结束。现在我们首先要找出每个循环包含的值以及在这个循环里的人。已知$m_i$是循环的一个值，那么对于所有的$j=(i+km)%n$，$m_j$必然也是循环的一个值。相似地，已知$a_i$在循环内，对于所有的$j=(i+kn)%m$，$a_j$必然也在同一个循环内。额外地，对于所有的$m_i$，$a_i$（假若存在的话）必然于其在同一个循环内。</p>
<p>已知每个循环的构成值以及在其中的人，我们可以大致知道每个人能走过几次循环直至它的财产清零，就是起始财产除以循环和。要知道这个人具体什么时候破产，我们需要知道这个循环的最小前缀和，因为倘若走到了某一圈这个人的财产加最小前缀和小等于零，那么它必然在这一点或其之前破产。由于在同一个循环内的多个人的起点可能不同，所以我们要用优先队列(维护范围内最小值，以当前前缀和来减)来计算对于每个起始点的最小前缀和。计算完之后我们可以从后往前遍历来找对于每个人:1)它要在循环里走几圈才会破产;2)利用1),它要赌几次才会破产;3)利用2)它在第几轮破产.</p>
<h3 id="Code"><a href="#Code" class="headerlink" title="Code"></a>Code</h3><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;bits/stdc++.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> fo(counter, starter, ender) for(ll counter = starter; counter &lt;= ender; counter++)</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> rfo(counter, starter, ender) for(ll counter = starter; counter &gt;= ender; counter--)</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> ll long long</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> INF 1e18</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> N 2000010</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> MOD 1000000007</span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</span><br><span class="line"><span class="function">ll <span class="title">qpow</span><span class="params">(ll x, ll y)</span></span>&#123;<span class="keyword">return</span> y?(y&amp;<span class="number">1</span>?x*qpow(x,y<span class="number">-1</span>)%MOD:qpow(x*x%MOD,y/<span class="number">2</span>)):<span class="number">1</span>;&#125;</span><br><span class="line"><span class="keyword">template</span>&lt;<span class="keyword">typename</span> T&gt;<span class="function"><span class="keyword">inline</span> <span class="keyword">void</span> <span class="title">read</span><span class="params">(T&amp;x)</span></span>&#123;</span><br><span class="line">    x = <span class="number">0</span>; <span class="keyword">char</span> c; <span class="keyword">int</span> sign = <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">do</span> &#123; c = getchar(); <span class="keyword">if</span>(c == <span class="string">&#x27;-&#x27;</span>) sign = <span class="number">-1</span>; &#125;<span class="keyword">while</span>(!<span class="built_in">isdigit</span>(c));</span><br><span class="line">    <span class="keyword">do</span> &#123; x = x * <span class="number">10</span> + c - <span class="string">&#x27;0&#x27;</span>; c = getchar(); &#125;<span class="keyword">while</span>(<span class="built_in">isdigit</span>(c));</span><br><span class="line">    x *= sign;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">ll sum[N], n, m, a[N], v[N], rmin[N], pre[N&lt;&lt;<span class="number">1</span>], Ans = INF;</span><br><span class="line"><span class="keyword">bool</span> book[N];</span><br><span class="line"><span class="keyword">char</span> str[N];</span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">monotone_queue</span>:</span><span class="built_in">deque</span>&lt;ll&gt;&#123;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">insert_back</span><span class="params">(ll val)</span></span>&#123;</span><br><span class="line">        <span class="keyword">while</span>(!empty() &amp;&amp; !(sum[back()] &lt; sum[val])) pop_back();</span><br><span class="line">        push_back(val);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line">    freopen(<span class="string">&quot;C.in&quot;</span>, <span class="string">&quot;r&quot;</span>, <span class="built_in">stdin</span>);</span><br><span class="line">    freopen(<span class="string">&quot;C.out&quot;</span>, <span class="string">&quot;w&quot;</span>, <span class="built_in">stdout</span>);</span><br><span class="line">    read(n);</span><br><span class="line">    fo(i, <span class="number">0</span>, n<span class="number">-1</span>) read(a[i]);</span><br><span class="line">    read(m);</span><br><span class="line">    <span class="built_in">scanf</span>(<span class="string">&quot;%s&quot;</span>, str);</span><br><span class="line">    fo(i, <span class="number">0</span>, m<span class="number">-1</span>) v[i] = str[i] == <span class="string">&#x27;W&#x27;</span>?<span class="number">1</span>:<span class="number">-1</span>;</span><br><span class="line"></span><br><span class="line">    fo(k, <span class="number">0</span>, m<span class="number">-1</span>)&#123;</span><br><span class="line">        <span class="keyword">if</span>(book[k]) <span class="keyword">continue</span>;</span><br><span class="line"></span><br><span class="line">        <span class="built_in">vector</span>&lt;<span class="keyword">int</span>&gt; ring;</span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">int</span> i = k; !book[i]; i = (i+n)%m) ring.push_back(i), book[i] = <span class="number">1</span>;</span><br><span class="line"></span><br><span class="line">        monotone_queue q;</span><br><span class="line">        fo(i, <span class="number">0</span>, <span class="number">2</span>*ring.size()<span class="number">-1</span>)&#123;</span><br><span class="line">            sum[i+<span class="number">1</span>] = sum[i] + v[ring[i%ring.size()]];</span><br><span class="line">            <span class="keyword">for</span>(q.insert_back(i+<span class="number">1</span>); q.back() - q.front() &gt; ring.size();) q.pop_front();</span><br><span class="line">            <span class="keyword">if</span>(i &gt;= ring.size()) rmin[i-ring.size()+<span class="number">1</span>] = sum[i - ring.size()] - sum[q.front()];</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">//rmin[1]: the max delta encountered by someone starting in the first element of the ring</span></span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">2</span>*ring.size(); pre[sum[i] + N] = i; i--)&#123;</span><br><span class="line">            <span class="keyword">if</span>(i &gt; ring.size()) <span class="keyword">continue</span>;</span><br><span class="line">            <span class="keyword">for</span>(<span class="keyword">int</span> j = ring[i<span class="number">-1</span>]; j &lt; n; j += m)</span><br><span class="line">                <span class="keyword">if</span>(sum[ring.size()] &lt; <span class="number">0</span> || a[j] &lt;= rmin[i])&#123;</span><br><span class="line">                    ll step;</span><br><span class="line">                    <span class="keyword">if</span>(a[j] &lt;= rmin[i]) step = pre[sum[i<span class="number">-1</span>] - a[j] + N] - i + <span class="number">1</span>;</span><br><span class="line">                    <span class="keyword">else</span> &#123;</span><br><span class="line">                        ll rcnt = (a[j] - rmin[i] - <span class="number">1</span>) / (-sum[ring.size()]) + <span class="number">1</span>;</span><br><span class="line">                        step = rcnt * ring.size() + pre[sum[i<span class="number">-1</span>] - a[j] - rcnt * sum[ring.size()] + N] - i + <span class="number">1</span>;</span><br><span class="line">                    &#125;</span><br><span class="line"></span><br><span class="line">                    <span class="comment">//step: how many gambles till broke</span></span><br><span class="line">                    <span class="comment">//rcnt: how many rings went through</span></span><br><span class="line">                    <span class="comment">//Ans = how many gambles till broke * time taken per gamble + time to get to in first gamble</span></span><br><span class="line"></span><br><span class="line">                    Ans = min(Ans, j + <span class="number">1</span> + n * (step - <span class="number">1</span>));</span><br><span class="line">                &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;%lld\n&quot;</span>, Ans == INF?<span class="number">-1ll</span>:Ans);</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>




    </div>

    
    
    
        

<div>
<ul class="post-copyright">
  <li class="post-copyright-author">
    <strong>Post author:  </strong>thyroidr
  </li>
  <li class="post-copyright-link">
    <strong>Post link: </strong>
    <a href="https://thyroidr.github.io/InfoBlogs/DTOJ/DTOJ/virtual-contest-2018-09-18/" title="Virtual Contest 2018&#x2F;09&#x2F;18">https://thyroidr.github.io/InfoBlogs/DTOJ/DTOJ/virtual-contest-2018-09-18/</a>
  </li>
  <li class="post-copyright-license">
    <strong>Copyright Notice:  </strong>All articles in this blog are licensed under <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" rel="noopener" target="_blank"><i class="fab fa-fw fa-creative-commons"></i>BY-NC-SA</a> unless stating additionally.
  </li>
</ul>
</div>


      <footer class="post-footer">
          <div class="post-tags">
              <a href="/InfoBlogs/tags/c/" rel="tag"># c++</a>
              <a href="/InfoBlogs/tags/segtree/" rel="tag"># segtree</a>
              <a href="/InfoBlogs/tags/monotone-data-structures/" rel="tag"># monotone data structures</a>
          </div>

        


        
    <div class="post-nav">
      <div class="post-nav-item">
    <a href="/InfoBlogs/Graph-Theory/Graph%20Theory/network-flow/" rel="prev" title="Flow Network">
      <i class="fa fa-chevron-left"></i> Flow Network
    </a></div>
      <div class="post-nav-item">
    <a href="/InfoBlogs/CodeForces/CodeForces/codeforces-510/" rel="next" title="CodeForces Round #510">
      CodeForces Round #510 <i class="fa fa-chevron-right"></i>
    </a></div>
    </div>
      </footer>
    
  </article>
  
  
  



          </div>
          

<script>
  window.addEventListener('tabs:register', () => {
    let { activeClass } = CONFIG.comments;
    if (CONFIG.comments.storage) {
      activeClass = localStorage.getItem('comments_active') || activeClass;
    }
    if (activeClass) {
      let activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
      if (activeTab) {
        activeTab.click();
      }
    }
  });
  if (CONFIG.comments.storage) {
    window.addEventListener('tabs:click', event => {
      if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
      let commentClass = event.target.classList[1];
      localStorage.setItem('comments_active', commentClass);
    });
  }
</script>

        </div>
          
  
  <div class="toggle sidebar-toggle">
    <span class="toggle-line toggle-line-first"></span>
    <span class="toggle-line toggle-line-middle"></span>
    <span class="toggle-line toggle-line-last"></span>
  </div>

  <aside class="sidebar">
    <div class="sidebar-inner">

      <ul class="sidebar-nav motion-element">
        <li class="sidebar-nav-toc">
          Table of Contents
        </li>
        <li class="sidebar-nav-overview">
          Overview
        </li>
      </ul>

      <!--noindex-->
      <div class="post-toc-wrap sidebar-panel">
          <div class="post-toc motion-element"><ol class="nav"><li class="nav-item nav-level-2"><a class="nav-link" href="#Q1-Siano"><span class="nav-number">1.</span> <span class="nav-text">Q1: Siano</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#English-Translation"><span class="nav-number">1.1.</span> <span class="nav-text">English Translation</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Input"><span class="nav-number">1.2.</span> <span class="nav-text">Input</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Output"><span class="nav-number">1.3.</span> <span class="nav-text">Output</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Sample-IO"><span class="nav-number">1.4.</span> <span class="nav-text">Sample IO</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Solution"><span class="nav-number">1.5.</span> <span class="nav-text">Solution</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Q2-Rozstaw-Szyn"><span class="nav-number">2.</span> <span class="nav-text">Q2: Rozstaw Szyn</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#English-Translation-1"><span class="nav-number">2.1.</span> <span class="nav-text">English Translation</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Input-1"><span class="nav-number">2.2.</span> <span class="nav-text">Input</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Output-1"><span class="nav-number">2.3.</span> <span class="nav-text">Output</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Sample-IO-1"><span class="nav-number">2.4.</span> <span class="nav-text">Sample IO</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Solution-1"><span class="nav-number">2.5.</span> <span class="nav-text">Solution</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Q3-Hazard"><span class="nav-number">3.</span> <span class="nav-text">Q3: Hazard</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#Description"><span class="nav-number">3.1.</span> <span class="nav-text">Description</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Input-2"><span class="nav-number">3.2.</span> <span class="nav-text">Input</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Output-2"><span class="nav-number">3.3.</span> <span class="nav-text">Output</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Sample-IO-2"><span class="nav-number">3.4.</span> <span class="nav-text">Sample IO</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Solution-2"><span class="nav-number">3.5.</span> <span class="nav-text">Solution</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Code"><span class="nav-number">3.6.</span> <span class="nav-text">Code</span></a></li></ol></li></ol></div>
      </div>
      <!--/noindex-->

      <div class="site-overview-wrap sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <img class="site-author-image" itemprop="image" alt="Ryan Wang"
      src="/InfoBlogs/images/avatar.png">
  <p class="site-author-name" itemprop="name">Ryan Wang</p>
  <div class="site-description" itemprop="description">Museum of my involvement in Informatics Olympiads & competitive programming</div>
</div>
<div class="site-state-wrap motion-element">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
          <a href="/InfoBlogs/archives/">
        
          <span class="site-state-item-count">74</span>
          <span class="site-state-item-name">posts</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
            <a href="/InfoBlogs/categories/">
          
        <span class="site-state-item-count">14</span>
        <span class="site-state-item-name">categories</span></a>
      </div>
      <div class="site-state-item site-state-tags">
            <a href="/InfoBlogs/tags/">
          
        <span class="site-state-item-count">53</span>
        <span class="site-state-item-name">tags</span></a>
      </div>
  </nav>
</div>
  <div class="links-of-author motion-element">
      <span class="links-of-author-item">
        <a href="https://github.com/thyroidr" title="GitHub → https:&#x2F;&#x2F;github.com&#x2F;thyroidr" rel="noopener" target="_blank"><i class="fab fa-github fa-fw"></i>GitHub</a>
      </span>
      <span class="links-of-author-item">
        <a href="mailto:ryanxiaowang2001@gmail.com" title="E-Mail → mailto:ryanxiaowang2001@gmail.com" rel="noopener" target="_blank"><i class="fa fa-envelope fa-fw"></i>E-Mail</a>
      </span>
      <span class="links-of-author-item">
        <a href="https://www.linkedin.com/in/rxw/" title="LinkedIn → https:&#x2F;&#x2F;www.linkedin.com&#x2F;in&#x2F;rxw&#x2F;" rel="noopener" target="_blank"><i class="fab fa-linkedin fa-fw"></i>LinkedIn</a>
      </span>
  </div>
  <div class="cc-license motion-element" itemprop="license">
    <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" class="cc-opacity" rel="noopener" target="_blank"><img src="/InfoBlogs/images/cc-by-nc-sa.svg" alt="Creative Commons"></a>
  </div>



      </div>

    </div>
  </aside>
  <div id="sidebar-dimmer"></div>


      </div>
    </main>

    <footer class="footer">
      <div class="footer-inner">
        

        

<div class="copyright">
  
  &copy; 2018 – 
  <span itemprop="copyrightYear">2021</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">Ryan Wang</span>
</div>
  <div class="powered-by">Powered by <a href="https://hexo.io/" class="theme-link" rel="noopener" target="_blank">Hexo</a> & <a href="https://mist.theme-next.org/" class="theme-link" rel="noopener" target="_blank">NexT.Mist</a>
  </div>

        








      </div>
    </footer>
  </div>

  
  <script src="/InfoBlogs/lib/anime.min.js"></script>
  <script src="/InfoBlogs/lib/velocity/velocity.min.js"></script>
  <script src="/InfoBlogs/lib/velocity/velocity.ui.min.js"></script>

<script src="/InfoBlogs/js/utils.js"></script>

<script src="/InfoBlogs/js/motion.js"></script>


<script src="/InfoBlogs/js/schemes/muse.js"></script>


<script src="/InfoBlogs/js/next-boot.js"></script>




  















  

  
      

<script>
  if (typeof MathJax === 'undefined') {
    window.MathJax = {
      loader: {
        source: {
          '[tex]/amsCd': '[tex]/amscd',
          '[tex]/AMScd': '[tex]/amscd'
        }
      },
      tex: {
        inlineMath: {'[+]': [['$', '$']]},
        tags: 'ams'
      },
      options: {
        renderActions: {
          findScript: [10, doc => {
            document.querySelectorAll('script[type^="math/tex"]').forEach(node => {
              const display = !!node.type.match(/; *mode=display/);
              const math = new doc.options.MathItem(node.textContent, doc.inputJax[0], display);
              const text = document.createTextNode('');
              node.parentNode.replaceChild(text, node);
              math.start = {node: text, delim: '', n: 0};
              math.end = {node: text, delim: '', n: 0};
              doc.math.push(math);
            });
          }, '', false],
          insertedScript: [200, () => {
            document.querySelectorAll('mjx-container').forEach(node => {
              let target = node.parentNode;
              if (target.nodeName.toLowerCase() === 'li') {
                target.parentNode.classList.add('has-jax');
              }
            });
          }, '', false]
        }
      }
    };
    (function () {
      var script = document.createElement('script');
      script.src = '//cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js';
      script.defer = true;
      document.head.appendChild(script);
    })();
  } else {
    MathJax.startup.document.state(0);
    MathJax.texReset();
    MathJax.typeset();
  }
</script>

    

  

</body>
</html>
